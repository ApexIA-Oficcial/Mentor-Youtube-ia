<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ApexiA - Mentor IA Profissional</title>
    
    <!-- Google Identity Services -->
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    
    <style>
        :root {
            --primary: #ff0000;
            --dark-bg: #0f0f0f;
            --card-bg: #1e1e1e;
            --text-main: #ffffff;
            --text-dim: #aaaaaa;
            --user-bubble: #ff0000;
            --ai-bubble: #2b2b2b;
        }

        body, html {
            margin: 0; padding: 0;
            font-family: 'Inter', -apple-system, sans-serif;
            background-color: var(--dark-bg);
            color: var(--text-main);
            height: 100vh; overflow: hidden;
        }

        /* TELA DE BOAS-VINDAS (LANDING) */
        #landing-page {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            height: 100vh; text-align: center; padding: 20px;
            background: radial-gradient(circle at center, #2b0000 0%, #0f0f0f 100%);
        }

        .logo-apexia { font-size: 3.5rem; font-weight: 900; letter-spacing: -2px; margin-bottom: 10px; text-transform: uppercase; }
        .logo-apexia span { color: var(--primary); }
        .tagline { font-size: 1.2rem; color: var(--text-dim); max-width: 500px; margin-bottom: 30px; line-height: 1.6; }

        .btn-google {
            background: white; color: black; padding: 15px 30px; border-radius: 35px;
            border: none; font-weight: bold; cursor: pointer; display: flex; align-items: center;
            gap: 12px; font-size: 1rem; transition: 0.3s;
        }
        .btn-google:hover { transform: scale(1.05); background: #eee; }

        /* INTERFACE DO CHAT */
        #app-container {
            display: none; flex-direction: column; height: 100vh;
            max-width: 1000px; margin: 0 auto; background: var(--dark-bg);
            border-left: 1px solid #333; border-right: 1px solid #333;
        }

        header {
            padding: 15px 25px; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid #333; background: rgba(15, 15, 15, 0.9);
        }

        .header-logo { font-weight: bold; font-size: 1.4rem; }
        .header-logo span { color: var(--primary); }

        #chat-window { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 20px; }

        .msg { max-width: 80%; padding: 15px 20px; border-radius: 18px; font-size: 1rem; line-height: 1.5; }
        .ai { align-self: flex-start; background-color: var(--ai-bubble); color: white; border-bottom-left-radius: 2px; white-space: pre-wrap; }
        .user { align-self: flex-end; background-color: var(--user-bubble); color: white; border-bottom-right-radius: 2px; }

        .data-chip { 
            background: rgba(0, 255, 0, 0.1); color: #00ff00; padding: 12px; 
            border-radius: 10px; font-size: 0.85rem; border: 1px solid rgba(0, 255, 0, 0.2); margin-bottom: 15px;
        }

        .input-box { padding: 20px; background: #1a1a1a; display: flex; gap: 12px; border-top: 1px solid #333; }
        input { flex: 1; background: #2a2a2a; border: 1px solid #444; padding: 15px 20px; border-radius: 30px; color: white; outline: none; }
        button#send-btn { background: var(--primary); color: white; border: none; padding: 10px 25px; border-radius: 30px; font-weight: bold; cursor: pointer; }
        
        #typing { color: var(--text-dim); font-size: 0.8rem; margin: 0 0 10px 25px; display: none; }
    </style>
</head>
<body>

    <!-- TELA DE LOGIN -->
    <div id="landing-page">
        <div class="logo-apexia">APEX<span>IA</span></div>
        <div class="tagline">Conecte seu canal para receber mentoria da nossa IA personalizada com seus dados reais.</div>
        
        <button class="btn-google" onclick="iniciarAuth()">
            <img src="https://upload.wikimedia.org/wikipedia/commons/5/53/Google_%22G%22_Logo.svg" width="20">
            Conectar Canal YouTube
        </button>
    </div>

    <!-- APP PRINCIPAL -->
    <div id="app-container">
        <header>
            <div class="header-logo">APEX<span>IA</span> MENTOR PRO</div>
            <div id="status-display" style="font-size: 0.7rem; color: #00ff00;">CONECTADO</div>
        </header>

        <div id="chat-window">
            <div id="stats-area"></div>
            <div class="msg ai">Acesso concedido! Estou pronto para analisar o seu canal. Aguarde enquanto leio seus dados b√°sicos...</div>
        </div>

        <div id="typing">ApexiA est√° analisando...</div>

        <div class="input-box">
            <input type="text" id="user-input" placeholder="Pergunte sobre seu canal...">
            <button id="send-btn" onclick="askMentor()">Analisar</button>
        </div>
    </div>

    <script>
        // CONFIGURA√á√ïES AUTOM√ÅTICAS
        const CLIENT_ID = "145100322345-70nlh619s577puk5c75u19trip13nkme.apps.googleusercontent.com";
        const API_KEY = "AIzaSyB9qcL9Po0t0cGPL3VkIRGcjlX20X3rEhU"; // <--- COLOQUE SUA CHAVE NOVA AQUI
        
        let accessToken = null;
        let canalInfoContexto = "";

        // 1. FLUXO DE LOGIN E PERMISS√ÉO DO YOUTUBE
        function iniciarAuth() {
            const client = google.accounts.oauth2.initTokenClient({
                client_id: CLIENT_ID,
                scope: 'https://www.googleapis.com/auth/youtube.readonly https://www.googleapis.com/auth/yt-analytics.readonly',
                callback: (response) => {
                    if (response.access_token) {
                        accessToken = response.access_token;
                        document.getElementById('landing-page').style.display = 'none';
                        document.getElementById('app-container').style.display = 'flex';
                        puxarDadosDoYouTube();
                    }
                },
            });
            client.requestAccessToken();
        }

        // 2. BUSCAR DADOS DO CANAL
        async function puxarDadosDoYouTube() {
            try {
                const res = await fetch('https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics&mine=true', {
                    headers: { 'Authorization': `Bearer ${accessToken}` }
                });
                const data = await res.json();
                const canal = data.items[0];
                
                const nome = canal.snippet.title;
                const subs = canal.statistics.subscriberCount;
                const videos = canal.statistics.videoCount;

                canalInfoContexto = `O canal chama-se ${nome}, possui ${subs} inscritos e ${videos} v√≠deos publicados.`;

                document.getElementById('stats-area').innerHTML = `
                    <div class="data-chip">
                        üìä <b>Canal Identificado:</b> ${nome} | <b>Inscritos:</b> ${Number(subs).toLocaleString()}
                    </div>
                `;
                
                addMsg('ai', `Tudo pronto, criador do canal **${nome}**! J√° tenho acesso aos seus n√∫meros. Como posso ajudar a subir o seu CTR ou sua Reten√ß√£o hoje?`);

            } catch (e) {
                console.error("Erro ao buscar dados", e);
            }
        }

        // 3. ENVIAR PARA IA
        async function askMentor() {
            const input = document.getElementById('user-input');
            const btn = document.getElementById('send-btn');
            const typing = document.getElementById('typing');
            const text = input.value.trim();

            if (!text) return;

            addMsg('user', text);
            input.value = '';
            btn.disabled = true;
            typing.style.display = 'block';

            // Contexto Master da ApexiA
            const promptFinal = `Voc√™ √© o Mentor Estrategista da ApexiA. 
            DADOS DO CANAL DO USU√ÅRIO: ${canalInfoContexto}
            CTR ATUAL SIMULADO: 4.5% | RETEN√á√ÉO ATUAL SIMULADA: 40%
            
            PERGUNTA DO USU√ÅRIO: ${text}
            
            Instru√ß√£o: D√™ uma resposta t√©cnica, curta e direta focada em crescimento (Growth).`;

            try {
                // Tentando os modelos dispon√≠veis
                const modelos = ["gemini-1.5-flash", "gemini-pro"];
                let respondido = false;

                for (let mod of modelos) {
                    const url = `https://generativelanguage.googleapis.com/v1beta/models/${mod}:generateContent?key=${API_KEY}`;
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type':
